<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.css">
    <style>
        .exercise-header {
            margin-top: 20px;
        }

        .editor-container {
            margin-top: 20px;
        }

        .result-container {
            margin-top: 30px;
        }

        .btn-run {
            margin-top: 20px;
        }

        .btn-clear {
            margin-top: 20px;
            margin-left: 10px;
        }

        .btn-submit {
            margin-top: 20px;
            margin-left: 10px;
        }

        .test-case-output {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Exercise Header -->
        <div class="row exercise-header">
            <div class="col-12">
                <h1 id="exercise-title"></h1>
                <p id="exercise-description"></p>
                <p><strong>Programming Language:</strong> <span id="exercise-language"></span></p>
                <p><strong>Difficulty Level:</strong> <span id="exercise-level"></span></p>
                <p><strong>Expiry Date:</strong> <span id="exercise-expired"></span></p>
                <p><strong>Score:</strong> <span id="exercise-score"></span></p>
            </div>
        </div>

        <!-- Code Editor -->
        <div class="row editor-container">
            <div class="col-12">
                <textarea id="code-editor" name="code" class="form-control" style="height: 400px;"></textarea>
            </div>
        </div>

        <!-- Buttons for Running Code -->
        <div class="row">
            <div class="col-12">
                <button id="btn-run" class="btn btn-primary btn-run">Run Code</button>
                <button id="btn-clear" class="btn btn-secondary btn-clear">Clear Code</button>
                <button id="btn-submit" class="btn btn-success btn-submit">Submit</button>
            </div>
        </div>

        <!-- Test Case Section -->
        <div class="row result-container">
            <div class="col-12">
                <h3>Test Cases</h3>
                <ul id="test-case-list" class="list-group">
                </ul>
            </div>
        </div>

        <!-- Output Section -->
        <div class="row">
            <div class="col-12">
                <div id="output-section">
                    <h3>Result</h3>
                    <div id="result-output" class="alert alert-info">
                        <!-- Display results of code execution here -->
                        <p>Output: <span id="actual-output">Waiting for submission...</span></p>
                        <p>Status: <span id="execution-status">Not Run</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row">
            <div class="col-12">
                <h3>Performance Metrics</h3>
                <p><strong>Time Taken:</strong> <span id="time-taken">N/A</span></p>
                <p><strong>Memory Used:</strong> <span id="memory-used">N/A</span></p>
            </div>
        </div>
    </div>

    <!-- Include required JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/python/python.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- <script>

        $(document).ready(function(){
            $.getJSON('Homework.json', function(data){

            })
        })

        // Sample data (you should replace this with actual data from backend)
        const exercise = {
            Name: "Array Basics",
            Description: "Learn how to work with arrays in Python.",
            Language: "Python",
            Level: "Medium",
            Expired: "10/15/2024",
            Score: 85,
            testCases: [
                { input: "5", expectedOutput: "10" },
                { input: "7", expectedOutput: "14" }
            ]
        };

        // Set the exercise data dynamically
        document.getElementById('exercise-title').innerText = exercise.Name;
        document.getElementById('exercise-description').innerText = exercise.Description;
        document.getElementById('exercise-language').innerText = exercise.Language;
        document.getElementById('exercise-level').innerText = exercise.Level;
        document.getElementById('exercise-expired').innerText = exercise.Expired;
        document.getElementById('exercise-score').innerText = exercise.Score;

        const testCaseList = document.getElementById('test-case-list');
        exercise.testCases.forEach((testCase, index) => {
            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');
            listItem.innerHTML = `
                <strong>Test Case ${index + 1}:</strong> 
                <span class="input">Input: ${testCase.input}</span> 
                <span class="output">Expected Output: ${testCase.expectedOutput}</span>
            `;
            testCaseList.appendChild(listItem);
        });

        // CodeMirror setup
        const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
            mode: "python",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true
        });

        // Event handlers
        document.getElementById('btn-run').addEventListener('click', () => {
            const code = editor.getValue();
            console.log("Running code:", code);  // Replace with actual code execution logic
            document.getElementById('actual-output').innerText = "Running...";
            document.getElementById('execution-status').innerText = "Success"; // For demo
        });

        document.getElementById('btn-clear').addEventListener('click', () => {
            editor.setValue('');
            document.getElementById('actual-output').innerText = "Waiting for submission...";
            document.getElementById('execution-status').innerText = "Not Run";
        });

        document.getElementById('btn-submit').addEventListener('click', () => {
            const code = editor.getValue();
            console.log("Submitting code:", code);  // Replace with actual submission logic
            document.getElementById('actual-output').innerText = "10";  // Example output
            document.getElementById('execution-status').innerText = "Success";  // Example status
        });
    </script> -->

    <script>
        $(document).ready(function () {
            // Lấy ID từ URL
            const urlParams = new URLSearchParams(window.location.search);
            const exerciseId = urlParams.get('Id');

            // Tải dữ liệu từ file JSON
            $.getJSON('Homework.json', function (data) {
                // Tìm bài tập dựa trên ID
                const exercise = data.find(ex => ex.Name.toLowerCase().replace(/\s+/g, '-') === exerciseId.toLowerCase().replace(/\s+/g, '-'));

                if (exercise) {
                    // Kiểm tra ngày hết hạn
                    const currentDate = new Date();
                    const expiredDate = new Date(exercise.Expired);

                    if (currentDate > expiredDate) {
                        // Hiển thị thông báo và chuyển hướng về Dashboard nếu quá hạn
                        alert("Bài tập đã hết hạn. Bạn không có quyền truy cập.");
                        window.location.href = "Dashboard.html";
                        return;
                    }

                    // Nếu không quá hạn, cập nhật thông tin bài tập lên giao diện
                    document.getElementById('exercise-title').innerText = exercise.Name;
                    document.getElementById('exercise-description').innerText = exercise.Description;
                    document.getElementById('exercise-language').innerText = exercise.Language;
                    document.getElementById('exercise-level').innerText = exercise.Level;
                    document.getElementById('exercise-expired').innerText = exercise.Expired;
                    document.getElementById('exercise-score').innerText = exercise.Score;

                    // Hiển thị các test cases
                    const testCaseList = document.getElementById('test-case-list');
                    exercise.testCases.forEach((testCase, index) => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('list-group-item');
                        listItem.innerHTML = `
                            <strong>Test Case ${index + 1}:</strong> 
                            <span class="input">Input: ${testCase.input}</span> 
                            <span class="output">Expected Output: ${testCase.expectedOutput}</span>
                        `;
                        testCaseList.appendChild(listItem);
                    });

                    // CodeMirror setup
                    const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
                        mode: "python",
                        theme: "dracula",
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true
                    });

                    // Event handlers
                    document.getElementById('btn-run').addEventListener('click', () => {
                        const code = editor.getValue();
                        console.log("Running code:", code);  // Replace with actual code execution logic
                        document.getElementById('actual-output').innerText = "Running...";
                        document.getElementById('execution-status').innerText = "Success"; // For demo
                    });

                    document.getElementById('btn-clear').addEventListener('click', () => {
                        editor.setValue('');
                        document.getElementById('actual-output').innerText = "Waiting for submission...";
                        document.getElementById('execution-status').innerText = "Not Run";
                    });

                    document.getElementById('btn-submit').addEventListener('click', () => {
                        const code = editor.getValue();
                        console.log("Submitting code:", code);  // Replace with actual submission logic
                        document.getElementById('actual-output').innerText = "10";  // Example output
                        document.getElementById('execution-status').innerText = "Success";  // Example status
                    });
                } else {
                    // Nếu không tìm thấy bài tập, chuyển hướng về Dashboard
                    alert("Bài tập không tồn tại.");
                    window.location.href = "Dashboard.html";
                }
            }).fail(function () {
                alert("Không thể tải dữ liệu bài tập.");
                window.location.href = "Dashboard.html";
            });
        });
    </script>

</body>

</html>